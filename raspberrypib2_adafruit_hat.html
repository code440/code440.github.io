
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="/theme/pygments/github.min.css">


  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/solid.css">




    <link rel="shortcut icon" href="/images/code-440.png" type="image/x-icon">
    <link rel="icon" href="/images/code-440.png" type="image/x-icon">

  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5K6T1R2Z1P"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5K6T1R2Z1P');
</script>
<!-- End of Global site tag (gtag.js) - Google Analytics -->
    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#440">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#440">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#440">

<meta name="author" content="code-440" />
<meta name="description" content="タンスから出てきたRaspberry Pi2 BにAdafruitのhat方法についてまとめた。" />
<meta name="keywords" content="Raspberry Pi, Adafruit, pwm servomotor">


<meta property="og:site_name" content="Tech Note 440s"/>
<meta property="og:title" content="タンスから出てきたRaspberry Pi2 BでPWMサーボモーターを動かす"/>
<meta property="og:description" content="タンスから出てきたRaspberry Pi2 BにAdafruitのhat方法についてまとめた。"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="/raspberrypib2_adafruit_hat.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2021-05-08 17:15:00+09:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="/author/code-440.html">
<meta property="article:section" content="Raspberry Pi"/>
<meta property="article:tag" content="Raspberry Pi"/>
<meta property="article:tag" content="Adafruit"/>
<meta property="article:tag" content="pwm servomotor"/>
<meta property="og:image" content="/images/raspberrypib2_adafruithat/0_cover.jpg">

  <title>Tech Note 440s &ndash; タンスから出てきたRaspberry Pi2 BでPWMサーボモーターを動かす</title>

  <script data-ad-client="ca-pub-3079184443691298" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Google Tag Manager -->
<script>
  (function(w,d,s,l,i){
    w[l]=w[l]||[];
    w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
    j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
    f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-N5F7W7G');
</script>
<!-- End Google Tag Manager --></head>
<body class="light-theme">
<!-- Google Tag Manager -->
<noscript>
  <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N5F7W7G" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<!-- End Google Tag Manager -->  <aside>
    <div>
      <a href="">
        <img src="/images/code-440.png" alt="code-440" title="code-440">
      </a>

      <h1>
        <a href="">code-440</a>
      </h1>



      <nav>
        <ul class="list">


              <li>
                <a target="_self"
                   href="/pages/about_site.html#about_site">
                  このサイトについて
                </a>
              </li>
              <li>
                <a target="_self"
                   href="/pages/privacy_policy.html#privacy_policy">
                  プライバシーポリシー
                </a>
              </li>

            <li>
              <a target="_self" href="" ></a>
            </li>
        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-You can add links in your config file" href="#" target="_blank">
              <i class="fab fa-You can add links in your config file"></i>
            </a>
          </li>
          <li>
            <a  class="sc-Another social link" href="#" target="_blank">
              <i class="fab fa-Another social link"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="">Home</a>



    </nav>

<article class="single">
  <header>
      
    <h1 id="raspberrypib2_adafruit_hat">タンスから出てきたRaspberry Pi2 BでPWMサーボモーターを動かす</h1>
    <p>
      Posted on Sat 08 May 2021 in <a href="/category/raspberry-pi.html">Raspberry Pi</a>

    </p>
  </header>


  <div>
    <p><img src="../images/raspberrypib2_adafruithat/0_cover.jpg" width="640"　alt='cover_image'></p>
<h2>はじめに</h2>
<p>故あってPWMサーボを制御しようと思い、手軽にできそうなものを探したところAdafruitの製品である「Adafruit 16-Channel PWM/Servo HAT &amp; Bonnet for Raspberry Pi」（以下：PWM/Servo HAT）に行き着いた。</p>
<p><a target="_blank"  href="https://www.amazon.co.jp/gp/product/B00SI1SPHS/ref=as_li_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=B00SI1SPHS&linkCode=as2&tag=code440-22&linkId=9ceb2865f1df4fb83c12d3ac86d0842c"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&MarketPlace=JP&ASIN=B00SI1SPHS&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL250_&tag=code440-22" ></a><br>
<a target="_blank" href="https://www.amazon.co.jp/gp/product/B00SI1SPHS/ref=as_li_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=B00SI1SPHS&linkCode=as2&tag=code440-22&linkId=e24840578640e8ab848a6a5c5d2d2841">Adafruit 16チャンネル PWM/サーボ HAT for Raspberry Pi</a>  </p>
<p>この商品は「Raspberry Pi(RasPi)」のピン配列に則って作られており、RasPiに差しこむだけで使用できる。<br>
そういえばRasPiを持っていたなと思い購入した次第である。<br>
さて、肝心のRasPiはどこかと片付けしながら探したところ、無事（？）タンスから「Raspberry Pi2 Model B」が出てきた。</p>
<p>OSのセットアップについては<a href="https://code440.github.io/raspberrypib2_mate_install.html">前記事</a>を参照のこと。</p>
<h2>Raspberry Piの設定変更</h2>
<p>PWM/Servo HATはRasPiのIC2機能を使って最大16本のPWMを制御することができる。<br>
一方で、RasPiの初期設定ではIC2を含めSPIやカメラモジュールなどの機能も切られているため、設定を変更する必要がある。
<a href="https://learn.adafruit.com/adafruits-raspberry-pi-lesson-4-gpio-setup/configuring-i2c">Adafruit公式のガイド</a>。</p>
<p>Adafruit公式ガイドの記述に対して、私の場合はOSとしてUbuntu　MATE16.04を使用しているため、[python-smbus]、[i2c-tools]は入っていた。<br>
一方で、[raspi-config]はインストールされていなかったので、インストールした上で実行し設定を変更した。</p>
<div class="highlight"><pre><span></span><code>sudo apt install raspi-config
sudo raspi-config
</code></pre></div>

<p>[Interfacing Options]から変更できる。
<img src="../images/raspberrypib2_adafruithat/raspberrypib2_adafruithat.png" width="640"　alt='raspi-config'></p>
<h2>PWM/Servo HATの接続</h2>
<p>PWM/Servo HATではPWMサーボ用の電源はRasPiと分けることを推奨している。
ここでは以下の写真のようにmicro-USB基板を用意し、配線を伸ばして接続した。
<img src="../images/raspberrypib2_adafruithat/0_cover.jpg" width="640"　alt='PWM/ServoHATの接続'></p>
<p>なお、USB基板は昔秋月電子で買ったものを使用した。
アマゾンだとこの当たりが近いか。</p>
<p><a target="_blank"  href="https://www.amazon.co.jp/gp/product/B01J7GEA30/ref=as_li_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=B01J7GEA30&linkCode=as2&tag=code440-22&linkId=f3012239bf751c32116f8e9378691ad6"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&MarketPlace=JP&ASIN=B01J7GEA30&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL250_&tag=code440-22" ></a><br>
<a target="_blank" href="https://www.amazon.co.jp/gp/product/B01J7GEA30/ref=as_li_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=B01J7GEA30&linkCode=as2&tag=code440-22&linkId=2eeb980db7f70ae764f4143c22fbad45">USBマイクロBコネクタ・ピッチ変換基板</a>  </p>
<p>改めて買うのであればType-Cが良いかもしれない。</p>
<p><a target="_blank"  href="https://www.amazon.co.jp/gp/product/B091XMX9NP/ref=as_li_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=B091XMX9NP&linkCode=as2&tag=code440-22&linkId=e5246fca480c21edc9f4acb8f6372f42"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&MarketPlace=JP&ASIN=B091XMX9NP&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL250_&tag=code440-22" ></a><br>
<a target="_blank" href="https://www.amazon.co.jp/gp/product/B091XMX9NP/ref=as_li_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=B091XMX9NP&linkCode=as2&tag=code440-22&linkId=f06f58e450c20e77f0223a4e8d7b01c7">CK-45 USB Type-C コネクタ変換基板 サンハヤト</a>  </p>
<h2>PWMサーボモーターの制御</h2>
<p>RasPiでPWM/Servo HATの利用にはAdafruitのPythonライブラリを利用する。この時、Adafruit公式では2つの方法が紹介されている。
一つは<a href="https://github.com/adafruit/Adafruit_CircuitPython_ServoKit">AdafruitのGithub</a>。
もう一つ、Adafruitの<a href="https://learn.adafruit.com/adafruit-16-channel-pwm-servo-hat-for-raspberry-pi/using-the-python-library">Python Usage</a>では以下のようにライブラリをインストールする。  </p>
<div class="highlight"><pre><span></span><code>sudo pip3 install adafruit-circuitpython-servokit
</code></pre></div>

<p>この時、以下のようなエラーが出てしまう場合はaptでインストールされているpip3が古いため[setuptool]のupdateを行う。</p>
<div class="highlight"><pre><span></span><code>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;/usr/bin/pip3&quot;</span>, line <span class="m">11</span>, in &lt;module&gt;
    sys.exit<span class="o">(</span>main<span class="o">())</span>
  File <span class="s2">&quot;/home/mate/.local/lib/python3.5/site-packages/pip/__init__.py&quot;</span>, line <span class="m">12</span>, in main
    from pip._internal.utils.entrypoints import _wrapper
  File <span class="s2">&quot;/home/mate/.local/lib/python3.5/site-packages/pip/_internal/utils/entrypoints.py&quot;</span>, line <span class="m">4</span>, in &lt;module&gt;
    from pip._internal.cli.main import main
  File <span class="s2">&quot;/home/mate/.local/lib/python3.5/site-packages/pip/_internal/cli/main.py&quot;</span>, line <span class="m">58</span>
    sys.stderr.write<span class="o">(</span>f<span class="s2">&quot;ERROR: {exc}&quot;</span><span class="o">)</span>
                                   ^
SyntaxError: invalid syntax
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="err">sudo pip3 install --upgrade setuptools</span>
</code></pre></div>

<p>※　コマンドをメモしていなかったので間違っているかもしれない。</p>
<p>ライブラリがインストールできたのならば、後はPythonで制御できる。</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">adafruit_servokit</span> <span class="kn">import</span> <span class="n">ServoKit</span>
<span class="n">kit</span> <span class="o">=</span> <span class="n">ServoKit</span><span class="p">(</span><span class="n">channels</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">kit</span><span class="o">.</span><span class="n">servo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="mi">180</span>
</code></pre></div>

<p>以下、動作の様子。</p>
<p><a href="">準備中</a></p>
<h2>おわりに</h2>
<p>今回はサンプルの設定をそのままで動かしたが、PWMサーボモーターはメーカー毎にPWMの範囲が異なっていることが多い。
Adafruitの<a href="https://learn.adafruit.com/adafruit-16-channel-pwm-servo-hat-for-raspberry-pi/library-reference">Library Reference</a>によると以下のような形で範囲を調整できるようだ。</p>
<div class="highlight"><pre><span></span><code><span class="n">pwm</span> <span class="o">=</span> <span class="n">PWM</span><span class="p">(</span><span class="mh">0x40</span><span class="p">)</span>
<span class="n">pwm</span><span class="o">.</span><span class="n">setPWM</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">3072</span><span class="p">)</span>
</code></pre></div>

<p>以上で本記事は終わるが、次はROSを絡めて使ってみたい。</p>
<p><a target="_blank"  href="https://www.amazon.co.jp/gp/product/4873119413/ref=as_li_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=4873119413&linkCode=as2&tag=code440-22&linkId=5d9ecb03e1d688dd933358254869e90b"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&MarketPlace=JP&ASIN=4873119413&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL250_&tag=code440-22" ></a><br>
<a target="_blank" href="https://www.amazon.co.jp/gp/product/4873119413/ref=as_li_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=4873119413&linkCode=as2&tag=code440-22&linkId=94aabe72e4d2ca612aee4b703701449a">Raspberry Piクックブック 第3版 (Make:PROJECTS)</a></p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="/tag/raspberry-pi.html">Raspberry Pi</a>
      <a href="/tag/adafruit.html">Adafruit</a>
      <a href="/tag/pwm-servomotor.html">pwm servomotor</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="/raspberrypib2_mate_install.html" title="タンスから出てきたRaspberry Pi2 B にUbuntu MATE16.04をインストールする方法">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
  </div>

  <div class="related-posts">
    <h4>You might enjoy</h4>
    <ul class="related-posts">
      <li><a href="/raspberrypib2_mate_install.html">タンスから出てきたRaspberry Pi2 B にUbuntu MATE16.04をインストールする方法</a></li>
    </ul>
  </div>


</article>

    <footer>
<p>&copy; 2021 code-440</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Tech Note 440s ",
  "url" : "",
  "image": "/images/code-440.png",
  "description": "pelican, python"
}
</script>


</body>
</html>